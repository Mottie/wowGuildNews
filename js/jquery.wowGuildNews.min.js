/* wowGuildNews minified v1.1 beta
 https://github.com/Mottie/wowGuildNews
 by Rob Garrison (Mottie) MIT licensed.
*/
;(function(g){g.fn.wowGuildNews=function(n){return this.each(function(){if(!this.initialized){var p=this,a=g.extend(!0,{show:25,small:!0,region:"us",locale:"en",server:"Lightning's Blade",guild:"Our Guild's Name",text:{guildinfo:"(Level {level} {faction} Guild, {server})",faction:["Alliance","Horde"],item:"{icon} {player} {action} {item}. {time}",achv:"{icon} {player} earned the achievement {ach} for {points} points. {time}",obtained:"obtained",crafted:"crafted",purchased:"purchased",guild:"The guild", future:"in",past:"ago",recent:"Recently",now:"Just now",min:"1 minute",mins:"minutes",hour:"1 hour",hours:"hours",yday:"Yesterday",days:"days",weeks:"weeks"},showFutureTime:!0,itemTooltip:"http://{locale}.wowhead.com/item={id}",achTooltip:"http://{locale}.wowhead.com/achievement={id}"},n),k="http://"+("cn"===a.region?"www.battlenet.com.cn":a.region+".battle.net"),l=k+"/api/wow/",q=k+"/wow/"+a.locale+"/character/"+escape(a.server.toLowerCase())+"/",m="http://media.blizzard.com/wow/icons/"+(a.small? "18":"56")+"/",h="wow-icon-"+(a.small?"small":"large"),r=a.itemTooltip.replace(/\{locale\}/g,"en"===a.locale?"www":a.locale),s=a.achTooltip.replace(/\{locale\}/g,"en"===a.locale?"www":a.locale),t=function(b){b=new Date(b||"");b=((new Date).getTime()-b.getTime())/1E3;var c=Math.floor(b/86400);return-1===c?!a.showFutureTime&&a.text.recent||-60<b&&a.text.recent||-120<b&&a.text.future+" "+a.text.min||-3600<b&&a.text.future+" "+-Math.floor(b/60)+" "+a.text.mins||-7200<b&&a.text.future+" "+a.text.hour|| -86400<b&&a.text.future+" "+-Math.floor(b/3600)+" "+a.text.hours:isNaN(c)||0>c||31<=c?"":0===c&&(60>b&&a.text.now||120>b&&" "+a.text.min+" "+a.text.past||3600>b&&Math.floor(b/60)+" "+a.text.mins+" "+a.text.past||7200>b&&a.text.hour+" "+a.text.past||86400>b&&Math.floor(b/3600)+" "+a.text.hours+" "+a.text.past)||1===c&&" "+a.text.yday||7>c&&c+" "+a.text.days+" "+a.text.past||31>c&&Math.ceil(c/7)+" "+a.text.weeks+" "+a.text.past},u=function(b){var c,d={"{player}":'<a class="wow-character-name" href="'+ q+escape(b.character)+'/">'+b.character+"</a>","{time}":'<span class="wow-action-time">'+t(b.timestamp)+"</span>."},e=/\{a\}/g,f=/\{player\}/gi;if(/item/.test(b.type))switch(d["{icon}"]='<span class="wow-icon '+h+" wow-icon-"+b.itemId+'"></span>',d["{item}"]=('<a class="wow-item wow-item-{id}" href="'+r+'">item {id}</a>').replace(/\{id\}/g,b.itemId),d["{action}"]='<span class="wow-action-type wow-action-{a}">{a}</span>',c=a.text.item.replace(/(\{(icon|player|action|item|time)\})/g,function(a){return d[a]}), b.type){case "itemLoot":return c.replace(e,a.text.obtained);case "itemCraft":return c.replace(e,a.text.crafted);case "itemPurchase":return c.replace(e,a.text.purchased)}else if(b.achievement)switch(d["{icon}"]='<span class="wow-icon '+h+'"><img class="'+h+'" src="'+m+b.achievement.icon+'.jpg"></span>',d["{ach}"]=('<a class="wow-{a}-achievement" href="'+s+'">'+b.achievement.title+"</a>").replace(/\{id\}/g,b.achievement.id),d["{points}"]='<span class="wow-points">'+b.achievement.points+"</span>",c= a.text.achv.replace(/(\{(icon|ach|points|time)\})/g,function(a){return d[a]}),b.type){case "playerAchievement":return c.replace(f,d["{player}"]).replace(e,"character");case "guildAchievement":return c.replace(f,a.text.guild).replace(e,"guild")}return'<span class="unknown">Unknown news item</span>'},v=l+"guild/"+escape(a.server)+"/"+escape(a.guild)+"?fields=news&jsonp=?",w=function(a){a.itemId&&g.ajax({url:l+"item/"+a.itemId+"?jsonp=?",dataType:"jsonp",async:!0,success:function(a){g(".wow-icon-"+a.id).html('<img class="'+ h+'" src="'+m+a.icon+'.jpg" alt="'+a.name+'">');g(".wow-item-"+a.id).addClass("q"+a.quality).html(a.name)}})};g.getJSON(v,function(b){var c,d=b.news,e=Math.min(d.length,a.show),f='<h3 class="wow-guild-name"><a href="'+k+"/wow/"+a.locale+"/guild/"+a.server.toLowerCase().replace(/\s/g,"-").replace(/\'/g,"")+"/"+a.guild.replace(/\s/g,"_").replace(/\'/g,"")+'/">'+b.name+'</a></h3><h4 class="wow-guild-info">',f=f+(a.text.guildinfo.replace(/(\{(level|faction|server)\})/gi,function(c){return{"{level}":'<span class="wow-guild-level">'+ b.level+"</span>","{faction}":'<span class="wow-guild-faction">'+a.text.faction[b.side]+"</span>","{server}":'<span class="wow-guild-realm">'+b.realm+"</span>"}[c]})+"</h4>");for(c=0;c<e;c++)f+='<div class="wow-news-item">'+u(d[c])+"</div>";g(p).addClass("wow-guild-news").html(f);for(c=0;c<e;c++)w(d[c])})}})}})(jQuery);
